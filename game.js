var Ce=Object.defineProperty;var Ae=(i,t,e)=>t in i?Ce(i,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[t]=e;var yt=(i,t,e)=>Ae(i,typeof t!="symbol"?t+"":t,e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const r of s)if(r.type==="childList")for(const o of r.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&n(o)}).observe(document,{childList:!0,subtree:!0});function e(s){const r={};return s.integrity&&(r.integrity=s.integrity),s.referrerPolicy&&(r.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?r.credentials="include":s.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function n(s){if(s.ep)return;s.ep=!0;const r=e(s);fetch(s.href,r)}})();const Ie=0;const $=Math.PI;function N(i){return Math.abs(i)}function H(i,t){return Math.min(i,t)}function lt(i,t){return Math.max(i,t)}function Z(i){return Math.sign(i)}function Nt(i,t=1){return(i%t+t)%t}function g(i,t=0,e=1){return i<t?t:i>e?e:i}function ht(i,t,e){return(e-=t)?g((i-t)/e):0}function gt(i,t,e){return t+g(i)*(e-t)}function Yt(i,t,e,n=a()){return 2*N(i.x-e.x)<t.x+n.x&&2*N(i.y-e.y)<t.y+n.y}function v(i=1,t=0){return t+Math.random()*(i-t)}function ae(i,t=0){return Math.floor(v(i,t))}function be(){return 2*ae(2)-1}function le(i=1){return new E().setAngle(v(2*$),i)}function De(i=1,t=0){return 0<i?le(i*v(t/i,1)**.5):new E}function Ot(i=new f,t=new f(0,0,0,1),e=!1){return e?i.lerp(t,v()):new f(v(i.r,t.r),v(i.g,t.g),v(i.b,t.b),v(i.a,t.a))}function a(i=0,t){return typeof i=="number"?new E(i,t??i):new E(i.x,i.y)}class E{constructor(t=0,e=0){this.x=t,this.y=e,this.isValid()}set(t=0,e=0){return this.x=t,this.y=e,this.isValid(),this}copy(){return new E(this.x,this.y)}add(t){return new E(this.x+t.x,this.y+t.y)}subtract(t){return new E(this.x-t.x,this.y-t.y)}multiply(t){return new E(this.x*t.x,this.y*t.y)}divide(t){return new E(this.x/t.x,this.y/t.y)}scale(t){return new E(this.x*t,this.y*t)}length(){return this.lengthSquared()**.5}lengthSquared(){return this.x**2+this.y**2}distance(t){return this.distanceSquared(t)**.5}distanceSquared(t){return(this.x-t.x)**2+(this.y-t.y)**2}normalize(t=1){const e=this.length();return e?this.scale(t/e):new E(0,t)}clampLength(t=1){const e=this.length();return e>t?this.scale(t/e):this}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}angle(){return Math.atan2(this.x,this.y)}setAngle(t=0,e=1){return this.x=e*Math.sin(t),this.y=e*Math.cos(t),this}rotate(t){const e=Math.cos(t);return t=Math.sin(t),new E(this.x*e-this.y*t,this.x*t+this.y*e)}setDirection(t,e=1){return t=Nt(t,4),a(t%2?t-1?-e:e:0,t%2?0:t?-e:e)}direction(){return N(this.x)>N(this.y)?0>this.x?3:1:0>this.y?2:0}invert(){return new E(this.y,-this.x)}floor(){return new E(Math.floor(this.x),Math.floor(this.y))}area(){return N(this.x*this.y)}lerp(t,e){return this.add(t.subtract(this).scale(g(e)))}arrayCheck(t){return 0<=this.x&&0<=this.y&&this.x<t.x&&this.y<t.y}toString(t=3){}isValid(){return typeof this.x=="number"&&!isNaN(this.x)&&typeof this.y=="number"&&!isNaN(this.y)}}function D(i,t,e,n){return new f(i,t,e,n)}class f{constructor(t=1,e=1,n=1,s=1){this.r=t,this.g=e,this.b=n,this.a=s,this.isValid()}set(t=1,e=1,n=1,s=1){return this.r=t,this.g=e,this.b=n,this.a=s,this.isValid(),this}copy(){return new f(this.r,this.g,this.b,this.a)}add(t){return new f(this.r+t.r,this.g+t.g,this.b+t.b,this.a+t.a)}subtract(t){return new f(this.r-t.r,this.g-t.g,this.b-t.b,this.a-t.a)}multiply(t){return new f(this.r*t.r,this.g*t.g,this.b*t.b,this.a*t.a)}divide(t){return new f(this.r/t.r,this.g/t.g,this.b/t.b,this.a/t.a)}scale(t,e=t){return new f(this.r*t,this.g*t,this.b*t,this.a*e)}clamp(){return new f(g(this.r),g(this.g),g(this.b),g(this.a))}lerp(t,e){return this.add(t.subtract(this).scale(g(e)))}setHSLA(t=0,e=0,n=1,s=1){t=Nt(t,1),e=g(e),n=g(n),e=.5>n?n*(1+e):n+e-n*e,n=2*n-e;const r=(o,h,l)=>1>6*(l=Nt(l,1))?o+6*(h-o)*l:1>2*l?h:2>3*l?o+(h-o)*(4-6*l):o;return this.r=r(n,e,t+1/3),this.g=r(n,e,t),this.b=r(n,e,t-1/3),this.a=s,this.isValid(),this}HSLA(){const t=g(this.r),e=g(this.g),n=g(this.b),s=g(this.a),r=Math.max(t,e,n),o=Math.min(t,e,n),h=(r+o)/2;let l=0,d=0;if(r!=o){let c=r-o;d=.5<h?c/(2-r-o):c/(r+o),t==r?l=(e-n)/c+(e<n?6:0):e==r?l=(n-t)/c+2:n==r&&(l=(t-e)/c+4)}return[l/6,d,h,s]}mutate(t=.05,e=0){return new f(this.r+v(t,-t),this.g+v(t,-t),this.b+v(t,-t),this.a+v(e,-e)).clamp()}toString(t=!0){const e=n=>(16>(n=255*g(n)|0)?"0":"")+n.toString(16);return"#"+e(this.r)+e(this.g)+e(this.b)+(t?e(this.a):"")}setHex(t){return typeof t=="string"&&t[0]=="#",[4,5,7,9].includes(t.length),6>t.length?(this.r=g(parseInt(t[1],16)/15),this.g=g(parseInt(t[2],16)/15),this.b=g(parseInt(t[3],16)/15),this.a=t.length==5?g(parseInt(t[4],16)/15):1):(this.r=g(parseInt(t.slice(1,3),16)/255),this.g=g(parseInt(t.slice(3,5),16)/255),this.b=g(parseInt(t.slice(5,7),16)/255),this.a=t.length==9?g(parseInt(t.slice(7,9),16)/255):1),this.isValid(),this}rgbaInt(){const t=255*g(this.r)|0,e=255*g(this.g)<<8,n=255*g(this.b)<<16,s=255*g(this.a)<<24;return t+e+n+s}isValid(){return typeof this.r=="number"&&!isNaN(this.r)&&typeof this.g=="number"&&!isNaN(this.g)&&typeof this.b=="number"&&!isNaN(this.b)&&typeof this.a=="number"&&!isNaN(this.a)}}D();D(0,0,0);D(.5,.5,.5);D(1,0,0);D(1,.5,0);D(1,1,0);D(0,1,0);D(0,1,1);D(0,0,1);D(.5,0,1);D(1,0,1);let O=a(),V=32,Jt=a(1920,1080),xt=a(),Re=!0,ze="arial",Pe=!1,he=!0;a(16);let rt=0,Me=1,Ne=1,Oe=1,Le=0,_e=.8,W=1,Zt=0,Qt=1,Be=!0,je=!1,Fe=.3,Ue=40,We=.7;a(640,80);function ke(i){O=i}function Ge(i){xt=i}class tt{constructor(t=a(),e=a(1),n,s=0,r=new f,o=0){this.pos=t.copy(),this.size=e,this.drawSize=void 0,this.tileInfo=n,this.angle=s,this.color=r,this.additiveColor=void 0,this.mirror=!1,this.mass=Me,this.damping=Ne,this.angleDamping=Oe,this.elasticity=Le,this.friction=_e,this.gravityScale=1,this.renderOrder=o,this.velocity=a(),this.angleVelocity=0,this.spawnTime=bt,this.children=[],this.clampSpeedLinear=!0,this.parent=void 0,this.localPos=a(),this.localAngle=0,this.collideRaycast=this.isSolid=this.collideSolidObjects=this.collideTiles=!1,q.push(this)}updateTransforms(){const t=this.parent;if(t){const e=t.getMirrorSign();this.pos=this.localPos.multiply(a(e,1)).rotate(-t.angle).add(t.pos),this.angle=e*this.localAngle+t.angle}for(const e of this.children)e.updateTransforms()}update(){if(!this.parent){if(this.clampSpeedLinear)this.velocity.x=g(this.velocity.x,-W,W),this.velocity.y=g(this.velocity.y,-W,W);else{var t=this.velocity.lengthSquared();t>W*W&&(t=W/t**.5,this.velocity.x*=t,this.velocity.y*=t)}if(t=this.pos.copy(),this.velocity.x*=this.damping,this.velocity.y*=this.damping,this.mass&&(this.velocity.y+=Zt*this.gravityScale),this.pos.x+=this.velocity.x,this.pos.y+=this.velocity.y,this.angle+=this.angleVelocity*=this.angleDamping,0<=this.angleDamping&&1>=this.angleDamping,0<=this.damping&&1>=this.damping,this.mass){var e=0>this.velocity.y;if(this.groundObject){var n=this.groundObject.velocity?this.groundObject.velocity.x:0;this.velocity.x=n+(this.velocity.x-n)*this.friction,this.groundObject=0}if(this.collideSolidObjects)for(var s of Se){if(!this.isSolid&&!s.isSolid||s.destroyed||s.parent||s==this||!Yt(this.pos,this.size,s.pos,s.size))continue;n=this.collideWithObject(s);var r=s.collideWithObject(this);if(!n||!r)continue;if(Yt(t,this.size,s.pos,s.size)){n=t.subtract(s.pos),r=n.length(),n=.01>r?le(.001):n.scale(.001/r),this.velocity=this.velocity.add(n),s.mass&&(s.velocity=s.velocity.subtract(n));continue}r=this.size.add(s.size);var o=2*(t.y-s.pos.y)>r.y+Zt;const l=2*N(t.y-s.pos.y)<r.y;var h=2*N(t.x-s.pos.x)<r.x;if(n=lt(this.elasticity,s.elasticity),o||h||!l){if(this.pos.y=s.pos.y+(r.y/2+.001)*Z(t.y-s.pos.y),s.groundObject&&e||!s.mass)e&&(this.groundObject=s),this.velocity.y*=-n;else if(s.mass){h=(this.mass*this.velocity.y+s.mass*s.velocity.y)/(this.mass+s.mass);const d=s.velocity.y*(s.mass-this.mass)/(this.mass+s.mass)+2*this.velocity.y*this.mass/(this.mass+s.mass);this.velocity.y=gt(n,h,this.velocity.y*(this.mass-s.mass)/(this.mass+s.mass)+2*s.velocity.y*s.mass/(this.mass+s.mass)),s.velocity.y=gt(n,h,d)}}!o&&l&&(this.pos.x=s.pos.x+(r.x/2+.001)*Z(t.x-s.pos.x),s.mass?(r=(this.mass*this.velocity.x+s.mass*s.velocity.x)/(this.mass+s.mass),o=s.velocity.x*(s.mass-this.mass)/(this.mass+s.mass)+2*this.velocity.x*this.mass/(this.mass+s.mass),this.velocity.x=gt(n,r,this.velocity.x*(this.mass-s.mass)/(this.mass+s.mass)+2*s.velocity.x*s.mass/(this.mass+s.mass)),s.velocity.x=gt(n,r,o)):this.velocity.x*=-n)}this.collideTiles&&mt(this.pos,this.size,this)&&!mt(t,this.size,this)&&(s=mt(a(t.x,this.pos.y),this.size,this),n=mt(a(this.pos.x,t.y),this.size,this),(s||!n)&&(this.velocity.y*=-this.elasticity,(this.groundObject=e)?this.pos.y=(t.y-this.size.y/2|0)+this.size.y/2+1e-4:this.pos.y=t.y),n&&(this.pos.x=t.x,this.velocity.x*=-this.elasticity))}}}render(){Tt(this.pos,this.drawSize||this.size,this.tileInfo,this.color,this.angle,this.mirror,this.additiveColor)}destroy(){if(!this.destroyed){this.destroyed=1,this.parent&&this.parent.removeChild(this);for(const t of this.children)t.destroy(t.parent=0)}}localToWorld(t){return this.pos.add(t.rotate(-this.angle))}worldToLocal(t){return t.subtract(this.pos).rotate(this.angle)}localToWorldVector(t){return t.rotate(this.angle)}worldToLocalVector(t){return t.rotate(-this.angle)}collideWithTile(t,e){return 0<t}collideWithObject(t){return!0}getAliveTime(){return bt-this.spawnTime}applyAcceleration(t){this.mass&&(this.velocity=this.velocity.add(t))}applyForce(t){this.applyAcceleration(t.scale(1/this.mass))}getMirrorSign(){return this.mirror?-1:1}addChild(t,e=a(),n=0){!t.parent&&this.children.includes(t),this.children.push(t),t.parent=this,t.localPos=e.copy(),t.localAngle=n}removeChild(t){t.parent==this&&this.children.includes(t),this.children.splice(this.children.indexOf(t),1),t.parent=0}setCollision(t=!0,e=!0,n=!0,s=!0){this.collideSolidObjects=t,this.isSolid=e,this.collideTiles=n,this.collideRaycast=s}toString(){}renderDebugInfo(){}}let m,at,k,Lt,j=a(),wt=[];class $t{constructor(t){this.image=t,this.size=a(t.width,t.height),this.glTexture=ui(t)}}function ce(i){return new E((i.x-j.x/2+.5)/V+O.x,(i.y-j.y/2+.5)/-V+O.y)}function ue(i){return new E((i.x-O.x)*V+j.x/2-.5,(i.y-O.y)*-V+j.y/2-.5)}function Tt(i,t=a(1),e,n=new f,s=0,r,o=new f(0,0,0,0),h=he,l,d){const c=e&&e.getTextureInfo();if(h)if(l&&(i=ce(i),t=t.scale(1/V)),c){var u=a(1).divide(c.size);h=e.pos.x*u.x,l=e.pos.y*u.y,d=e.size.x*u.x;const p=e.size.y*u.y;u=u.scale(rt),hi(c.glTexture),ne(i.x,i.y,r?-t.x:t.x,t.y,s,h+u.x,l+u.y,h-u.x+d,l-u.y+p,n.rgbaInt(),o.rgbaInt())}else ne(i.x,i.y,t.x,t.y,s,0,0,0,0,0,n.rgbaInt());else t=a(t.x,-t.y),qe(i,t,s,r,p=>{if(c){const S=e.pos.x+rt,_=e.pos.y+rt,et=e.size.x-2*rt,A=e.size.y-2*rt;p.globalAlpha=n.a,p.drawImage(c.image,S,_,et,A,-.5,-.5,1,1),p.globalAlpha=1}else p.fillStyle=n,p.fillRect(-.5,-.5,1,1)},l,d)}function te(i,t,e,n,s,r,o){Tt(i,t,void 0,e,n,!1,void 0,s,r,o)}function qe(i,t,e,n,s,r,o=at){r||(i=ue(i),t=t.scale(V)),o.save(),o.translate(i.x+.5,i.y+.5),o.rotate(e),o.scale(n?-t.x:t.x,-t.y),s(o),o.restore()}function ee(i,t=he,e){t?Dt=i:(e||(e=at),e.globalCompositeOperation=i?"lighter":"source-over")}function He(i,t,e=1,n=new f,s=0,r=new f(0,0,0),o="center",h=ze,l,d=Lt){d.fillStyle=n.toString(),d.lineWidth=s,d.strokeStyle=r.toString(),d.textAlign=o,d.font=e+"px "+h,d.textBaseline="middle",d.lineJoin="round",t=t.copy(),(i+"").split(`
`).forEach(c=>{s&&d.strokeText(c,t.x,t.y,l),d.fillText(c,t.x,t.y,l),t.y+=e})}function Ve(i,t=0){return w[t]&&!!(w[t][i]&1)}function Xe(i,t=0){return w[t]&&!!(w[t][i]&2)}function de(){w=[[]]}const Ke=Xe;let ye=a(),Et=a(),Ct=!1;function ot(i,t=0){return Ve(i,t+1)}let w=[[]];function Ye(){ge||document.hasFocus()||de(),ye=ce(Et),Qe()}function Je(){for(const i of w)for(const t in i)i[t]&=1}function Ze(){function i(t){return t=="KeyW"?"ArrowUp":t=="KeyS"?"ArrowDown":t=="KeyA"?"ArrowLeft":t=="KeyD"?"ArrowRight":t}onkeydown=t=>{t.repeat||(Ct=!1,w[0][t.code]=3,w[0][i(t.code)]=3)},onkeyup=t=>{w[0][t.code]=4,w[0][i(t.code)]=4},onmousedown=t=>{C&&C.state!="running"&&C.resume(),Ct=!1,w[0][t.button]=3,Et=_t(t),t.button&&t.preventDefault()},onmouseup=t=>w[0][t.button]=w[0][t.button]&2|4,onmousemove=t=>Et=_t(t),onwheel=t=>t.ctrlKey?0:Z(t.deltaY),oncontextmenu=t=>!1,onblur=t=>de(),ge&&Be&&$e()}function _t(i){if(!m||Pe)return a();const t=m.getBoundingClientRect();return a(m.width,m.height).multiply(a(ht(i.x,t.left,t.right),ht(i.y,t.top,t.bottom)))}const ie=[];function Qe(){const i=o=>{const h=l=>.3<l?ht(l,.3,.8):-.3>l?-ht(-l,.3,.8):0;return a(h(o.x),h(-o.y)).clampLength()};var t,e,n,s;if(navigator&&navigator.getGamepads&&document.hasFocus())for(t=navigator.getGamepads(),e=t.length;e--;){s=t[e];const o=w[e+1]||(w[e+1]=[]);if(n=ie[e]||(ie[e]=[]),s){for(var r=0;r<s.axes.length-1;r+=2)n[r>>1]=i(a(s.axes[r],s.axes[r+1]));for(r=s.buttons.length;r--;){const h=s.buttons[r],l=ot(r,e);o[r]=h.pressed?l?1:3:l?4:0,Ct||(Ct=!e&&h.pressed)}s=a((ot(15,e)&&1)-(ot(14,e)&&1),(ot(12,e)&&1)-(ot(13,e)&&1)),s.lengthSquared()&&(n[0]=s.clampLength())}}}const ge=window.ontouchstart!==void 0;function $e(){function i(n){C&&C.state!="running"&&C.resume();const s=n.touches.length;if(s){const r=a(n.touches[0].clientX,n.touches[0].clientY);Et=_t(r),e?Ct=je:w[0][0]=3}else e&&(w[0][0]=w[0][0]&2|4);return e=s,document.hasFocus()&&n.preventDefault(),!0}let t=i;document.addEventListener("touchstart",n=>t(n),{passive:!1}),document.addEventListener("touchmove",n=>t(n),{passive:!1}),document.addEventListener("touchend",n=>t(n),{passive:!1}),onmousedown=onmouseup=()=>0;let e}let C=new AudioContext,vt;function ti(){vt=C.createGain(),vt.connect(C.destination),vt.gain.value=Fe}class kt{constructor(t,e=Ue,n=We){this.range=e,this.taper=n,this.randomness=0,t&&(this.randomness=t[1]!=null?t[1]:.05,t[1]=0,this.sampleChannels=[ii(...t)],this.sampleRate=Gt)}play(t,e=1,n=1,s=1,r=!1){if(this.sampleChannels){var o;if(t){if(o=this.range){const h=O.distanceSquared(t);if(h>o*o)return;e*=ht(h**.5,o,o*this.taper)}o=2*ue(t).x/m.width-1}return t=n+n*this.randomness*s*v(-1,1),this.gainNode=C.createGain(),this.source=ei(this.sampleChannels,e,t,o,r,this.sampleRate,this.gainNode)}}setVolume(t=1){this.gainNode&&(this.gainNode.gain.value=t)}stop(){this.source&&this.source.stop(),this.source=void 0}getSource(){return this.source}playNote(t,e,n){return this.play(e,n,2**(t/12),0)}getDuration(){return this.sampleChannels&&this.sampleChannels[0].length/this.sampleRate}isLoading(){return!this.sampleChannels}}function ei(i,t=1,e=1,n=0,s=!1,r=Gt,o){{var h=C.createBuffer(i.length,i[0].length,r),l=C.createBufferSource();return i.forEach((d,c)=>h.getChannelData(c).set(d)),l.buffer=h,l.playbackRate.value=e,l.loop=s,o=o||C.createGain(),o.gain.value=t,o.connect(vt),i=new StereoPannerNode(C,{pan:g(n,-1,1)}),l.connect(i).connect(o),C.state!="running"?C.resume().then(()=>l.start()):l.start(),l}}const Gt=44100;function ii(i=1,t=.05,e=220,n=0,s=0,r=.1,o=0,h=1,l=0,d=0,c=0,u=0,p=0,S=0,_=0,et=0,A=0,it=1,F=0,ct=0,X=0){let I=2*$;var x=Gt;let Rt=l*=500*I/x/x;t=e*=v(1+t,1-t)*I/x;let K=[],L=0,zt=0,T=0,st=1,Te=0,Ee=0,R=0,Y;var ut=I*N(X)*2/x,nt=Math.cos(ut),dt=Math.sin(ut)/2/2,U=1+dt;ut=-2*nt/U,dt=(1-dt)/U;let Ht=(1+Z(X)*nt)/2/U;nt=-(Z(X)+nt)/U;let Vt=U=0,Xt=0,Kt=0;for(n=n*x+9,F*=x,s*=x,r*=x,A*=x,d*=500*I/x**3,_*=I/x,c*=I/x,u*=x,p=p*x|0,Y=n+F+s+r+A|0;T<Y;K[T++]=R*i)++Ee%(100*et|0)||(R=o?1<o?2<o?3<o?Math.sin(L**3):g(Math.tan(L),1,-1):1-(2*L/I%2+2)%2:1-4*N(Math.round(L/I)-L/I):Math.sin(L),R=(p?1-ct+ct*Math.sin(I*T/p):1)*Z(R)*N(R)**h*(T<n?T/n:T<n+F?1-(T-n)/F*(1-it):T<n+F+s?it:T<Y-A?(Y-T-A)/r*it:0),R=A?R/2+(A>T?0:(T<Y-A?1:(Y-T)/A)*K[T-A|0]/2/i):R,X&&(R=Kt=Ht*U+nt*(U=Vt)+Ht*(Vt=R)-dt*Xt-ut*(Xt=Kt))),x=(e+=l+=d)*Math.cos(_*zt++),L+=x+x*S*Math.sin(T**5),st&&++st>u&&(e+=c,t+=c,st=0),!p||++Te%p||(e=t,l=Rt,st=st||1);return K}let si=[],Pt=a();function mt(i,t=a(),e){const n=lt(i.x-t.x/2|0,0);var s=lt(i.y-t.y/2|0,0);const r=H(i.x+t.x/2,Pt.x);for(i=H(i.y+t.y/2,Pt.y);s<i;++s)for(t=n;t<r;++t){const o=si[s*Pt.x+t];if(o&&(!e||e.collideWithTile(o,a(t,s))))return!0}return!1}class ni extends tt{constructor(t,e,n=0,s=0,r=100,o=$,h,l=new f,d=new f,c=new f(1,1,1,0),u=new f(1,1,1,0),p=.5,S=.1,_=1,et=.1,A=.05,it=1,F=1,ct=0,X=$,I=.1,x=.2,Rt=!1,K=!1,L=!0,zt=K?1e9:0,T=!1){super(t,a(),h,e,void 0,zt),this.emitSize=n,this.emitTime=s,this.emitRate=r,this.emitConeAngle=o,this.colorStartA=l,this.colorStartB=d,this.colorEndA=c,this.colorEndB=u,this.randomColorLinear=L,this.particleTime=p,this.sizeStart=S,this.sizeEnd=_,this.speed=et,this.angleSpeed=A,this.damping=it,this.angleDamping=F,this.gravityScale=ct,this.particleConeAngle=X,this.fadeRate=I,this.randomness=x,this.collideTiles=Rt,this.additive=K,this.localSpace=T,this.trailScale=0,this.particleCreateCallback=this.particleDestroyCallback=void 0,this.emitTimeBuffer=0}update(){if(this.parent&&super.update(),!this.emitTime||this.getAliveTime()<=this.emitTime){if(this.emitRate*Qt){const t=1/this.emitRate/Qt;for(this.emitTimeBuffer+=Ii;0<this.emitTimeBuffer;this.emitTimeBuffer-=t)this.emitParticle()}}else this.destroy()}emitParticle(){var t=typeof this.emitSize=="number"?De(this.emitSize/2):a(v(-.5,.5),v(-.5,.5)).multiply(this.emitSize).rotate(this.angle);let e=v(this.particleConeAngle,-this.particleConeAngle);this.localSpace||(t=this.pos.add(t),e+=this.angle);const n=this.randomness;var s=p=>p+p*v(n,-n);const r=s(this.particleTime),o=s(this.sizeStart),h=s(this.sizeEnd),l=s(this.speed);s=s(this.angleSpeed)*be();var d=v(this.emitConeAngle,-this.emitConeAngle);const c=Ot(this.colorStartA,this.colorStartB,this.randomColorLinear),u=Ot(this.colorEndA,this.colorEndB,this.randomColorLinear);return d=this.localSpace?d:this.angle+d,t=new ri(t,this.tileInfo,e,c,u,r,o,h,this.fadeRate,this.additive,this.trailScale,this.localSpace&&this,this.particleDestroyCallback),t.velocity=a().setAngle(d,l),t.angleVelocity=s,t.fadeRate=this.fadeRate,t.damping=this.damping,t.angleDamping=this.angleDamping,t.elasticity=this.elasticity,t.friction=this.friction,t.gravityScale=this.gravityScale,t.collideTiles=this.collideTiles,t.renderOrder=this.renderOrder,t.mirror=!!ae(2),this.particleCreateCallback&&this.particleCreateCallback(t),t}render(){}}class ri extends tt{constructor(t,e,n,s,r,o,h,l,d,c,u,p,S){super(t,a(),e,n),this.colorStart=s,this.colorEndDelta=r.subtract(s),this.lifeTime=o,this.sizeStart=h,this.sizeEndDelta=l-h,this.fadeRate=d,this.additive=c,this.trailScale=u,this.localSpaceEmitter=p,this.destroyCallback=S,this.clampSpeedLinear=!1}render(){const t=H((bt-this.spawnTime)/this.lifeTime,1),e=a(this.sizeStart+t*this.sizeEndDelta);var n=this.fadeRate/2;n=new f(this.colorStart.r+t*this.colorEndDelta.r,this.colorStart.g+t*this.colorEndDelta.g,this.colorStart.b+t*this.colorEndDelta.b,(this.colorStart.a+t*this.colorEndDelta.a)*(t<n?t/n:t>1-n?(1-t)/n:1)),this.additive&&ee(!0);let s=this.pos,r=this.angle;if(this.localSpaceEmitter&&(s=this.localSpaceEmitter.pos.add(s.rotate(-this.localSpaceEmitter.angle)),r+=this.localSpaceEmitter.angle),this.trailScale){var o=this.velocity;this.localSpaceEmitter&&(o=o.rotate(-this.localSpaceEmitter.angle));var h=o.length();h&&(o=o.scale(1/h),h*=this.trailScale,e.y=lt(e.x,h),r=o.angle(),Tt(s.add(o.multiply(a(0,-h/2))),e,this.tileInfo,n,r,this.mirror))}else Tt(s,e,this.tileInfo,n,r,this.mirror);this.additive&&ee(),t==1&&(this.color=n,this.size=e,this.destroyCallback&&this.destroyCallback(this),this.destroyed=1)}}let M,y,oi=!0,St,Bt,me,jt,b,Ft,B,Dt,At;function ai(){{M=document.createElement("canvas"),y=M.getContext("webgl2",{antialias:oi});var i=m.parentElement;i.appendChild(M),St=ci(`#version 300 es
precision highp float;uniform mat4 m;in vec2 g;in vec4 p,u,c,a;in float r;out vec2 v;out vec4 d,e;void main(){vec2 s=(g-.5)*p.zw;gl_Position=m*vec4(p.xy+s*cos(r)-vec2(-s.y,s)*sin(r),1,1);v=mix(u.xw,u.zy,g);d=c;e=a;}`,`#version 300 es
precision highp float;uniform sampler2D s;in vec2 v;in vec4 d,e;out vec4 c;void main(){c=texture(s,v)*d+e;}`),i=new ArrayBuffer(ve),b=new Float32Array(i),Ft=new Uint32Array(i),me=y.createBuffer(),jt=y.createBuffer(),i=new Float32Array([B=0,0,1,0,0,1,1,1]),y.bindBuffer(Q,jt),y.bufferData(Q,i,Ti)}}function li(){{y.viewport(0,0,M.width=m.width,M.height=m.height),y.clear(Si),y.useProgram(St),y.activeTexture(wi),wt[0]&&y.bindTexture(G,Bt=wt[0].glTexture);var i=Dt=At=0,t=(n,s,r,o)=>{n=y.getAttribLocation(St,n);const h=r&&xe,l=r&&1,d=r==1;y.enableVertexAttribArray(n),y.vertexAttribPointer(n,o,s,d,h,i),y.vertexAttribDivisor(n,l),i+=o*r};y.bindBuffer(Q,jt),t("g",pt,0,2),y.bindBuffer(Q,me),y.bufferData(Q,ve,Ei),t("p",pt,4,4),t("u",pt,4,4),t("c",It,1,4),t("a",It,1,4),t("r",pt,4,1),t=a(2*V).divide(j);var e=a(-1).subtract(O.multiply(t));y.uniformMatrix4fv(y.getUniformLocation(St,"m"),!1,[t.x,0,0,0,0,t.y,0,0,1,1,1,1,e.x,e.y,0,0])}}function hi(i){i==Bt||(qt(),y.bindTexture(G,Bt=i))}function se(i,t){return t=y.createShader(t),y.shaderSource(t,i),y.compileShader(t),t}function ci(i,t){const e=y.createProgram();return y.attachShader(e,se(i,Ai)),y.attachShader(e,se(t,Ci)),y.linkProgram(e),e}function ui(i){const t=y.createTexture();return y.bindTexture(G,t),i&&i.width?y.texImage2D(G,0,ft,ft,It,i):(i=new Uint8Array([255,255,255,255]),y.texImage2D(G,0,ft,1,1,0,ft,It,i)),i=fi,y.texParameteri(G,vi,i),y.texParameteri(G,xi,i),t}function qt(){if(B){var i=At?re:mi;y.blendFuncSeparate(gi,i,re,i),y.enable(pi),y.bufferSubData(Q,0,b),y.drawArraysInstanced(yi,0,4,B),B=0,At=Dt}}function di(i,t=!1){(B||t)&&(qt(),!t||i.drawImage(M,0,0))}function ne(i,t,e,n,s,r,o,h,l,d,c=0){(B>=fe||At!=Dt)&&qt();let u=B*pe;b[u++]=i,b[u++]=t,b[u++]=e,b[u++]=n,b[u++]=r,b[u++]=o,b[u++]=h,b[u++]=l,Ft[u++]=d,Ft[u++]=c,b[u++]=s,B++}const re=1,yi=5,gi=770,mi=771,pi=3042,G=3553,It=5121,pt=5126,ft=6408,fi=9728,xi=10240,vi=10241,Si=16384,wi=33984,Q=34962,Ti=35044,Ei=35048,Ci=35632,Ai=35633,pe=11,fe=1e4,xe=4*pe,ve=fe*xe,Ut=60,Ii=1/Ut;let q=[],Se=[],bi=0,bt=0,oe=0,z=0;const Di=[],Ri=[];function zi(i,t,e,n,s,r=[],o=document.body){function h(c=0){var u=c-oe;oe=c,c=Ie,z+=u,c||(z=H(z,50)),l();{for(u=0,0>z&&-9<z&&(u=z,z=0);0<=z;z-=1e3/Ut)bt=bi++/Ut,Ye(),t(),Di.forEach(S=>S()),Pi(),Je();z+=u}{j=a(m.width,m.height),Lt.imageSmoothingEnabled=at.imageSmoothingEnabled=!Re,li(),n(),q.sort((S,_)=>S.renderOrder-_.renderOrder);for(var p of q)p.destroyed||p.render();s(),Ri.forEach(S=>S()),di(at)}requestAnimationFrame(h)}function l(){{if(xt.x){m.width=xt.x,m.height=xt.y;const c=innerWidth/innerHeight,u=m.width/m.height;(M||m).style.width=m.style.width=k.style.width=c<u?"100%":"",(M||m).style.height=m.style.height=k.style.height=c<u?"":"100%"}else m.width=H(innerWidth,Jt.x),m.height=H(innerHeight,Jt.y);k.width=m.width,k.height=m.height,j=a(m.width,m.height)}}function d(){new Promise(c=>c(i())).then(h)}o.style.cssText="margin:0;overflow:hidden;width:100vw;height:100vh;display:flex;align-items:center;justify-content:center;background:#000;image-rendering:pixelated;user-select:none;-webkit-user-select:none;touch-action:none;-webkit-touch-callout:none",o.appendChild(m=document.createElement("canvas")),at=m.getContext("2d"),Ze(),ti(),ai(),o.appendChild(k=document.createElement("canvas")),Lt=k.getContext("2d"),m.style.cssText=k.style.cssText="position:absolute",M&&(M.style.cssText="position:absolute"),l(),o=r.map((c,u)=>new Promise(p=>{const S=new Image;S.onerror=S.onload=()=>{wt[u]=new $t(S),p()},S.src=c})),r.length||o.push(new Promise(c=>{wt[0]=new $t(new Image),c()})),Promise.all(o).then(d)}function Pi(){function i(t){if(!t.destroyed){t.update();for(const e of t.children)i(e)}}Se=q.filter(t=>t.collideSolidObjects);for(const t of q)t.parent||(i(t),t.updateTransforms());q=q.filter(t=>!t.destroyed)}class Wt extends tt{constructor(e){super(a(0,1),a(6,.5));yt(this,"levelSize");this.setCollision(),this.mass=0,this.levelSize=e}update(){this.pos.x=ye.x,this.pos.x=g(this.pos.x,this.size.x/2,this.levelSize.x-this.size.x/2)}}class Mi extends tt{constructor(e){super(e);yt(this,"sound_bounce",new kt([,,1e3,,.03,.02,1,2,,,940,.03,,,,,.2,.6,,.06],0));this.velocity=a(-.1,-.1),this.setCollision(),this.elasticity=1}collideWithObject(e){if(e instanceof Wt&&this.velocity.y>0)return!1;const n=H(1.04*this.velocity.length(),.5);if(this.velocity=this.velocity.normalize(n),this.sound_bounce.play(this.pos,1,n),e instanceof Wt){const s=this.pos.x-e.pos.x;return this.velocity=this.velocity.rotate(.3*s),this.velocity.y=lt(-this.velocity.y,.2),!1}return!0}}class Mt extends tt{constructor(t,e){super(t,e),this.setCollision(),this.mass=0,this.color=new f(0,0,0,0)}}class Ni extends tt{constructor(e,n){super(e,n);yt(this,"sound_break",new kt([,,90,,.01,.03,4,,,,,,,9,50,.2,,.2,.01],0));this.setCollision(),this.mass=0}collideWithObject(){this.destroy(),this.sound_break.play(this.pos),Li(1);const e=this.color;return new ni(this.pos,0,this.size,.1,200,$,void 0,e,e,e.scale(1,0),e.scale(1,0),.2,.5,1,.1,.1,.99,.95,.4,$,.1,.5,!1,!0),!0}}const P=a(38,20),Oi=new kt([,0,500,,.04,.3,1,2,,,570,.02,.02,,,,.04]);let J,we=0;function Li(i){we+=i}function _i(){for(let i=2;i<=P.x-2;i+=2)for(let t=12;t<=P.y-2;t++){const e=new Ni(a(i,t),a(2,1));e.color=Ot()}ke(a(P.scale(.5))),Ge(a(1280,720)),new Wt(P),new Mt(a(-.5,P.y/2),a(1,100)),new Mt(a(P.x+.5,P.y/2),a(1,100)),new Mt(a(P.x/2,P.y+.5),a(100,1))}function Bi(){J&&J.pos.y<-1&&(J.destroy(),J=null),!J&&Ke(0)&&(J=new Mi(O),Oi.play())}function ji(){}function Fi(){te(O,a(100),new f(.5,.5,.5)),te(O,P,new f(.1,.1,.1))}function Ui(){He(`Score: ${we}`,a(j.x/2,70),50)}zi(_i,Bi,ji,Fi,Ui,["tiles.png"]);
